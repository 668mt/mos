(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-441d4c92"],{"1dd2":function(t,e,i){"use strict";i.r(e);var n,a=function(){var t=this,e=this,i=e.$createElement,n=e._self._c||i;return n("div",{staticClass:"video-block"},[n("a-row",{attrs:{type:"flex"}},[n("a-col",{staticStyle:{"padding-right":"5px"},attrs:{xs:{span:24},sm:{span:16}}},[n("div",{staticClass:"player",staticStyle:{width:"100%",height:"100%"},attrs:{id:"videoContainer"}},[n("video")]),e.active?n("div",{staticStyle:{padding:"10px"}},[n("h4",[e._v(e._s(e.active.fileName))]),n("div",{staticClass:"space"},[n("span",{staticClass:"span-desc"},[e._v(e._s(e.active.visits)+"次观看")]),n("span",{staticClass:"span-desc"},[e._v("文件大小："+e._s(e.active.readableSize))]),n("span",{staticClass:"span-desc"},[e._v("更新时间："+e._s(e.active.updatedDate))])])]):e._e()]),n("a-col",{staticStyle:{color:"#fff"},attrs:{xs:{span:24},sm:{span:8}}},[n("div",[n("div",{ref:"container",staticClass:"video-list-container",staticStyle:{border:"1px solid #ccc","overflow-y":"auto","overflow-x":"hidden"}},[n("a-affix",{attrs:{target:function(){return t.$refs.container},"offset-top":1}},[n("div",{staticStyle:{padding:"10px",color:"#000",background:"#fff"}},[n("span",{staticStyle:{"font-weight":"600","font-size":"14px",margin:"0"}},[e._v("文件夹："+e._s(e.query.path))]),n("br"),n("span",{staticStyle:{"font-size":"12px",color:"#999"}},[e._v("当前播放："+e._s(e.currentPlayIndex)),n("span",{staticStyle:{margin:"0 3px"}},[e._v("/")]),e._v(e._s(e.page.total?e.page.total:0))])])]),n("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.handleInfiniteOnLoad,expression:"handleInfiniteOnLoad"}],staticClass:"demo-infinite-container video-list",attrs:{"infinite-scroll-disabled":!e.page.hasNextPage,"infinite-scroll-distance":10}},[n("a-list",{attrs:{"item-layout":"horizontal","data-source":e.page.list,locale:{emptyText:"暂无数据"}},scopedSlots:e._u([{key:"renderItem",fn:function(t,i){return n("a-list-item",{class:"list-item "+(e.active&&e.active.id===t.id?"active":""),on:{click:function(i){return e.playChange(t)}}},[n("a-list-item-meta",[n("div",{staticStyle:{overflow:"hidden","line-height":"20px"},attrs:{slot:"title"},slot:"title"},[n("h4",{staticStyle:{"word-break":"break-all",overflow:"hidden","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",display:"-webkit-box"}},[e._v(" "+e._s(t.fileName)+" ")])]),n("div",{staticStyle:{"line-height":"12px"},attrs:{slot:"description"},slot:"description"},[n("div",{staticClass:"space"},[n("span",{staticClass:"span-desc"},[e._v(e._s(t.visits)+"次观看")]),n("span",{staticClass:"span-desc"},[e._v(e._s(t.readableSize))])])]),n("div",{staticStyle:{"padding-left":"20px",position:"relative","font-size":"12px"},attrs:{slot:"avatar"},slot:"avatar"},[n("div",{staticStyle:{position:"absolute",left:"0","font-size":"12px",width:"15px","text-align":"center","line-height":"65px",color:"#000"}},[e._v(" "+e._s(i+1)+" ")]),n("Thumb",{staticStyle:{width:"110px",height:"65px"},attrs:{src:"/mos/"+e.query.bucket+t.urlEncodePath+"?thumb=true"}})],1)])],1)}}])},[e.loading&&e.page.hasNextPage?n("div",{staticClass:"demo-loading-container"},[n("a-spin")],1):e._e()])],1)],1)])])],1)],1)},s=[],o=(i("99af"),i("c975"),i("b85c")),r=i("1157"),l=i.n(r),c=i("c492"),d=i("1a47"),u=i.n(d),p=i("487a"),h=i.n(p),v={name:"VideoViewer",directives:{infiniteScroll:h.a},components:{Thumb:c["a"]},data:function(){return{query:{},page:{},active:void 0,loading:!1,pageSize:50}},mounted:function(){var t=this.$route.query;this.query=t;var e=t.id,i=t.bucket,n=t.path;e&&i&&n?(this.fetchResource(),this.resize()):this.$message.warn("参数错误!")},methods:{nextVideo:function(){var t=this.page.list,e=this.currentPlayIndex;t&&(t[e]?this.playResource(t[e]):this.playResource(t[0]))},playChange:function(t){this.playResource(t)},resize:function(){var t=l()("#videoContainer"),e=t.width(),i=e/1.6;t.css("height",i+"px"),u.a.isMobile()||l()(".video-list-container").css("height",i+"px")},handleInfiniteOnLoad:function(){(void 0===this.page.hasNextPage||this.page.hasNextPage)&&this.fetchRecentResources(this.page.pageNum+1)},fetchRecentResources:function(t){var e=this,i=this.query.bucket,n=this.query.path;this.loading=!0,this.$http.get("/member/resource/".concat(i,"/files/video"),{params:{path:n,pageNum:t||1,pageSize:this.pageSize}}).then((function(t){var i=e.page.list,n=t.data;i||(i=[]);var a,s=Object(o["a"])(n.list);try{for(s.s();!(a=s.n()).done;){var r=a.value;i.push(r)}}catch(l){s.e(l)}finally{s.f()}n.list=i,e.page=n,e.loading=!1}),(function(t){return e.loading=!1}))},fetchResource:function(){var t=this,e=this.query.bucket,i=this.query.id,n=this.query.path;this.$http.get("/member/resource/".concat(e,"/file/").concat(i),{params:{path:n}}).then((function(e){var i=e.data;t.playResource(i)}))},playResource:function(t){document.title=t.fileName,this.active=t;var e=t.signUrl;e=e.replaceAll("render=true","render=false");var i=e.indexOf("?");this.playVideo(encodeURIComponent(e.substring(0,i))+e.substring(i)),history.pushState({},t.fileName,"/viewer/video?id=".concat(t.id,"&bucket=").concat(this.query.bucket,"&path=").concat(encodeURIComponent(this.query.path)))},play:function(t,e){var i=this,a={container:"#videoContainer",variable:"player",video:t,loop:!1,click:!0,html5m3u8:e,autoplay:e,loaded:function(t){t.videoPlay()},volume:.5};n?n.newVideo({autoplay:!0,video:decodeURIComponent(t)}):(n=new ckplayer(a),n.addListener("ended",(function(t){i.nextVideo()})))},playMp4:function(t){this.play(t,!1)},playM3U8:function(t){this.play(t,!0)},playVideo:function(t){-1!==t.indexOf(".m3u8")?this.playM3U8(t):this.playMp4(t)}},computed:{currentPlayIndex:function(){if(this.page&&this.page.list&&this.active)for(var t=0;t<this.page.list.length;t++){var e=this.page.list[t];if(this.active.id===e.id)return t+1}return this.active?this.active.rowNum:0}}},f=v,m=(i("218d"),i("2877")),g=Object(m["a"])(f,a,s,!1,null,"4f6c1887",null);e["default"]=g.exports},"218d":function(t,e,i){"use strict";var n=i("6b28"),a=i.n(n);a.a},"487a":function(t,e,i){(function(e,i){t.exports=i()})(0,(function(){"use strict";var t="@@InfiniteScroll",e=function(t,e){var i,n,a,s,o,r=function(){t.apply(s,o),n=i};return function(){if(s=this,o=arguments,i=Date.now(),a&&(clearTimeout(a),a=null),n){var t=e-(i-n);t<0?r():a=setTimeout((function(){r()}),t)}else r()}},i=function(t){return t===window?Math.max(window.pageYOffset||0,document.documentElement.scrollTop):t.scrollTop},n=document.defaultView.getComputedStyle,a=function(t){var e=t;while(e&&"HTML"!==e.tagName&&"BODY"!==e.tagName&&1===e.nodeType){var i=n(e).overflowY;if("scroll"===i||"auto"===i)return e;e=e.parentNode}return window},s=function(t){return t===window?document.documentElement.clientHeight:t.clientHeight},o=function(t){return t===window?i(window):t.getBoundingClientRect().top+i(window)},r=function(t){var e=t.parentNode;while(e){if("HTML"===e.tagName)return!0;if(11===e.nodeType)return!1;e=e.parentNode}return!1},l=function(){if(!this.binded){this.binded=!0;var t=this,i=t.el,n=i.getAttribute("infinite-scroll-throttle-delay"),s=200;n&&(s=Number(t.vm[n]||n),(isNaN(s)||s<0)&&(s=200)),t.throttleDelay=s,t.scrollEventTarget=a(i),t.scrollListener=e(c.bind(t),t.throttleDelay),t.scrollEventTarget.addEventListener("scroll",t.scrollListener),this.vm.$on("hook:beforeDestroy",(function(){t.scrollEventTarget.removeEventListener("scroll",t.scrollListener)}));var o=i.getAttribute("infinite-scroll-disabled"),r=!1;o&&(this.vm.$watch(o,(function(e){t.disabled=e,!e&&t.immediateCheck&&c.call(t)})),r=Boolean(t.vm[o])),t.disabled=r;var l=i.getAttribute("infinite-scroll-distance"),d=0;l&&(d=Number(t.vm[l]||l),isNaN(d)&&(d=0)),t.distance=d;var u=i.getAttribute("infinite-scroll-immediate-check"),p=!0;u&&(p=Boolean(t.vm[u])),t.immediateCheck=p,p&&c.call(t);var h=i.getAttribute("infinite-scroll-listen-for-event");h&&t.vm.$on(h,(function(){c.call(t)}))}},c=function(t){var e=this.scrollEventTarget,n=this.el,a=this.distance;if(!0===t||!this.disabled){var r=i(e),l=r+s(e),c=!1;if(e===n)c=e.scrollHeight-l<=a;else{var d=o(n)-o(e)+n.offsetHeight+r;c=l+a>=d}c&&this.expression&&this.expression()}},d={bind:function(e,i,n){e[t]={el:e,vm:n.context,expression:i.value};var a=arguments;e[t].vm.$on("hook:mounted",(function(){e[t].vm.$nextTick((function(){r(e)&&l.call(e[t],a),e[t].bindTryCount=0;var i=function i(){e[t].bindTryCount>10||(e[t].bindTryCount++,r(e)?l.call(e[t],a):setTimeout(i,50))};i()}))}))},unbind:function(e){e&&e[t]&&e[t].scrollEventTarget&&e[t].scrollEventTarget.removeEventListener("scroll",e[t].scrollListener)}},u=function(t){t.directive("InfiniteScroll",d)};return window.Vue&&(window.infiniteScroll=d,Vue.use(u)),d.install=u,d}))},"6b28":function(t,e,i){}}]);
//# sourceMappingURL=chunk-441d4c92.8b6fd886.js.map