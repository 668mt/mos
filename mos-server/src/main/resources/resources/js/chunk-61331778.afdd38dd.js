(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61331778"],{"16e5":function(t,e,i){"use strict";var n=i("553d"),a=i.n(n);a.a},"1dd2":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"video-block"},[i("a-row",{attrs:{type:"flex"}},[i("a-col",{staticStyle:{"padding-right":"5px"},attrs:{xs:{span:24},sm:{span:24},md:{span:16}}},[t.isMobile?i("a-affix",[i("div",{staticClass:"player",staticStyle:{width:"100%",height:"100%"},attrs:{id:"videoContainer"}},[i("video")])]):i("div",{staticClass:"player",staticStyle:{width:"100%",height:"100%"},attrs:{id:"videoContainer"}},[i("video")]),t.active?i("div",{staticStyle:{padding:"10px"}},[i("h4",[t._v(t._s(t.active.fileName))]),i("div",{staticClass:"space"},[i("span",{staticClass:"span-desc"},[t._v(t._s(t.active.visits)+"次观看")]),i("span",{staticClass:"span-desc"},[t._v("文件大小："+t._s(t.active.readableSize))]),i("span",{staticClass:"span-desc"},[t._v("更新时间："+t._s(t.active.updatedDate))])])]):t._e()],1),i("a-col",{staticStyle:{color:"#fff"},attrs:{xs:{span:24},sm:{span:24},md:{span:8}}},[i("div",[i("div",{staticClass:"video-container-header",staticStyle:{padding:"10px",color:"#000",background:"#fff"}},[i("span",{staticStyle:{"font-weight":"600","font-size":"14px",margin:"0"}},[t._v("文件夹："+t._s(t.query.path))]),i("br"),i("span",{staticStyle:{"font-size":"12px",color:"#999"}},[t._v("当前播放："+t._s(t.currentPlayIndex)),i("span",{staticStyle:{margin:"0 3px"}},[t._v("/")]),t._v(t._s(t.maxTotal)+" "),i("a-icon",{staticStyle:{cursor:"pointer","margin-left":"10px"},attrs:{type:"environment"},on:{click:t.scrollToPosition}})],1)]),i("div",{ref:"container",staticClass:"video-list-container",staticStyle:{border:"1px solid #ccc","overflow-y":"auto","overflow-x":"hidden"}},[i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.handleInfiniteOnLoad,expression:"handleInfiniteOnLoad"}],ref:"infinite",staticClass:"demo-infinite-container video-list",attrs:{"infinite-scroll-disabled":!t.hasNextPage,"infinite-scroll-distance":10}},[i("a-list",{attrs:{"item-layout":"horizontal","data-source":t.videos,locale:{emptyText:"暂无数据"}},scopedSlots:t._u([{key:"renderItem",fn:function(e,n){return i("a-list-item",{class:"list-item "+(t.active&&t.active.id===e.id?"active":""),on:{click:function(i){return t.playChange(e)}}},[i("a-list-item-meta",[i("div",{staticStyle:{overflow:"hidden","line-height":"20px"},attrs:{slot:"title"},slot:"title"},[i("h4",{staticStyle:{"word-break":"break-all",overflow:"hidden","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",display:"-webkit-box"}},[t._v(" "+t._s(e.fileName)+" ")])]),i("div",{staticStyle:{"line-height":"12px"},attrs:{slot:"description"},slot:"description"},[i("div",{staticClass:"space"},[i("span",{staticClass:"span-desc"},[t._v(t._s(e.visits)+"次观看")]),i("span",{staticClass:"span-desc"},[t._v(t._s(e.readableSize))])])]),i("div",{staticStyle:{"padding-left":"25px",position:"relative","font-size":"12px"},attrs:{slot:"avatar"},slot:"avatar"},[i("div",{staticStyle:{position:"absolute",left:"0","font-size":"12px",width:"25px","text-align":"center","line-height":"65px",color:"#000"}},[t._v(" "+t._s(n+1)+" ")]),i("Thumb",{staticStyle:{width:"110px",height:"65px"},attrs:{"video-length":e.videoLength,src:"/mos/"+t.query.bucket+e.urlEncodePath+"?thumb=true"}})],1)])],1)}}])},[t.loading&&t.hasNextPage?i("div",{staticClass:"demo-loading-container"},[i("a-spin")],1):t._e()])],1)])])])],1)],1)},a=[],s=(i("99af"),i("c975"),i("b64b"),i("ac1f"),i("5319"),i("b85c")),o=i("1157"),r=i.n(o),l=i("c492"),c=i("1a47"),d=i.n(c),u=i("487a"),h=i.n(u);function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e,i){return e&&f(t.prototype,e),i&&f(t,i),t}var m,g=function(){function t(){v(this,t),this.state=!1}return p(t,[{key:"doWithLock",value:function(t){var e=this;if(!this.state){this.state=!0;var i=t();return this.state=!1,i}setTimeout((function(){return e.doWithLock(t)}),100)}}]),t}(),y={name:"VideoViewer",directives:{infiniteScroll:h.a},components:{Thumb:l["a"]},data:function(){return{query:{},pages:{},active:void 0,loading:!1,pageSize:50,lock:new g}},mounted:function(){var t=this.$route.query;this.query=t;var e=t.id,i=t.bucket,n=t.path;e&&i&&n?(this.fetchResource(),this.resize()):this.$message.warn("参数错误!")},methods:{scrollToPosition:function(){this.scrollToIndex(this.currentPlayIndex)},scrollToIndex:function(t){var e=this,i=this.$el.getElementsByClassName("video-list-container")[0],n=this.$el.getElementsByClassName("list-item");if(t>n.length)return this.handleInfiniteOnLoad(),void setTimeout((function(){return e.scrollToIndex(t)}),100);var a=n[t-1];i.scrollTop=a.offsetTop},nextVideo:function(){var t=this.videos,e=this.currentPlayIndex;t&&(t[e]?this.playResource(t[e]):this.playResource(t[0]))},playChange:function(t){this.playResource(t)},resize:function(){var t=r()("#videoContainer"),e=t.width(),i=e/1.6;if(t.css("height",i+"px"),d.a.isMobile())r()(".video-list-container").css("height","800px");else{var n=r()(".video-container-header").css("height");r()(".video-list-container").css("height","calc(".concat(i,"px - ").concat(n,")"))}},handleInfiniteOnLoad:function(){this.hasNextPage&&this.fetchRecentResources(this.nextPageNum)},fetchRecentResources:function(t){var e=this;if(t=t||1,!this.pages["p"+t]){var i=this.query.bucket,n=this.query.path;this.loading=!0,this.$http.get("/member/resource/".concat(i,"/files/video"),{params:{path:n,pageNum:t,pageSize:this.pageSize}}).then((function(i){var n=i.data;e.loading=!1,e.$set(e.pages,"p"+t,n)}),(function(t){return e.loading=!1}))}},fetchResource:function(){var t=this,e=this.query.bucket,i=this.query.id,n=this.query.path;this.$http.get("/member/resource/".concat(e,"/file/video/").concat(i),{params:{path:n}}).then((function(e){var i=e.data;t.playResource(i),t.scrollToPosition()}))},playResource:function(t){document.title=t.fileName,this.active=t;var e=t.signUrl;this.playVideo(e),this.isMobile||history.pushState({},t.fileName,"/viewer/video?id=".concat(t.id,"&bucket=").concat(this.query.bucket,"&path=").concat(encodeURIComponent(this.query.path)))},play:function(t,e){var i=this,n=d.a.getCookie("vol"),a={container:"#videoContainer",variable:"player",video:t,loop:!1,click:!0,html5m3u8:e,autoplay:e,loaded:function(t){t.videoPlay(),t.addListener("volume",(function(t){d.a.setCookie("vol",t,30)}))},volume:null!==n?n:.5};m?(a.video=decodeURIComponent(t),a.autoplay=!0,m.newVideo(a)):(m=new ckplayer(a),m.addListener("ended",(function(t){i.nextVideo()})))},playMp4:function(t){this.play(t,!1)},playM3U8:function(t){this.play(t,!0)},playVideo:function(t){if(t=t.replace("render=true","render=false"),t=t.replace("localhost","192.168.0.174"),-1!==t.indexOf(".m3u8"))this.playM3U8(t);else{var e=t.indexOf("?");t=encodeURIComponent(t.substring(0,e))+t.substring(e),this.playMp4(t)}}},computed:{videos:function(){var t=[];for(var e in this.pages){var i,n=Object(s["a"])(this.pages[e].list);try{for(n.s();!(i=n.n()).done;){var a=i.value;t.push(a)}}catch(o){n.e(o)}finally{n.f()}}return t},hasNextPage:function(){if(!this.pages)return!0;for(var t=1,e=0,i=Object.keys(this.pages);e<i.length;e++){var n=i[e];t=Math.max(parseInt(n.replace("p","")),t)}var a=this.pages["p"+t];return!a||a.hasNextPage},nextPageNum:function(){if(!this.pages)return 1;for(var t=0,e=0,i=Object.keys(this.pages);e<i.length;e++){var n=i[e];t=Math.max(parseInt(n.replace("p","")),t)}return t+1},maxTotal:function(){if(!this.pages)return 0;var t=this.pages["p1"];return t?t.total:0},isMobile:function(){return d.a.isMobile()},currentPlayIndex:function(){if(!this.active)return 0;if(this.active.rowNum)return this.active.rowNum;for(var t=0;t<this.videos.length;t++){var e=this.videos[t];if(this.active.id===e.id)return t+1}return 0}}},b=y,x=(i("16e5"),i("2877")),w=Object(x["a"])(b,n,a,!1,null,"513d90f4",null);e["default"]=w.exports},"487a":function(t,e,i){(function(e,i){t.exports=i()})(0,(function(){"use strict";var t="@@InfiniteScroll",e=function(t,e){var i,n,a,s,o,r=function(){t.apply(s,o),n=i};return function(){if(s=this,o=arguments,i=Date.now(),a&&(clearTimeout(a),a=null),n){var t=e-(i-n);t<0?r():a=setTimeout((function(){r()}),t)}else r()}},i=function(t){return t===window?Math.max(window.pageYOffset||0,document.documentElement.scrollTop):t.scrollTop},n=document.defaultView.getComputedStyle,a=function(t){var e=t;while(e&&"HTML"!==e.tagName&&"BODY"!==e.tagName&&1===e.nodeType){var i=n(e).overflowY;if("scroll"===i||"auto"===i)return e;e=e.parentNode}return window},s=function(t){return t===window?document.documentElement.clientHeight:t.clientHeight},o=function(t){return t===window?i(window):t.getBoundingClientRect().top+i(window)},r=function(t){var e=t.parentNode;while(e){if("HTML"===e.tagName)return!0;if(11===e.nodeType)return!1;e=e.parentNode}return!1},l=function(){if(!this.binded){this.binded=!0;var t=this,i=t.el,n=i.getAttribute("infinite-scroll-throttle-delay"),s=200;n&&(s=Number(t.vm[n]||n),(isNaN(s)||s<0)&&(s=200)),t.throttleDelay=s,t.scrollEventTarget=a(i),t.scrollListener=e(c.bind(t),t.throttleDelay),t.scrollEventTarget.addEventListener("scroll",t.scrollListener),this.vm.$on("hook:beforeDestroy",(function(){t.scrollEventTarget.removeEventListener("scroll",t.scrollListener)}));var o=i.getAttribute("infinite-scroll-disabled"),r=!1;o&&(this.vm.$watch(o,(function(e){t.disabled=e,!e&&t.immediateCheck&&c.call(t)})),r=Boolean(t.vm[o])),t.disabled=r;var l=i.getAttribute("infinite-scroll-distance"),d=0;l&&(d=Number(t.vm[l]||l),isNaN(d)&&(d=0)),t.distance=d;var u=i.getAttribute("infinite-scroll-immediate-check"),h=!0;u&&(h=Boolean(t.vm[u])),t.immediateCheck=h,h&&c.call(t);var v=i.getAttribute("infinite-scroll-listen-for-event");v&&t.vm.$on(v,(function(){c.call(t)}))}},c=function(t){var e=this.scrollEventTarget,n=this.el,a=this.distance;if(!0===t||!this.disabled){var r=i(e),l=r+s(e),c=!1;if(e===n)c=e.scrollHeight-l<=a;else{var d=o(n)-o(e)+n.offsetHeight+r;c=l+a>=d}c&&this.expression&&this.expression()}},d={bind:function(e,i,n){e[t]={el:e,vm:n.context,expression:i.value};var a=arguments;e[t].vm.$on("hook:mounted",(function(){e[t].vm.$nextTick((function(){r(e)&&l.call(e[t],a),e[t].bindTryCount=0;var i=function i(){e[t].bindTryCount>10||(e[t].bindTryCount++,r(e)?l.call(e[t],a):setTimeout(i,50))};i()}))}))},unbind:function(e){e&&e[t]&&e[t].scrollEventTarget&&e[t].scrollEventTarget.removeEventListener("scroll",e[t].scrollListener)}},u=function(t){t.directive("InfiniteScroll",d)};return window.Vue&&(window.infiniteScroll=d,Vue.use(u)),d.install=u,d}))},"553d":function(t,e,i){}}]);
//# sourceMappingURL=chunk-61331778.afdd38dd.js.map